/*
Copyright(c) 2012 Company Name
*/
Ext.define("NotesApp.model.Note",{extend:"Ext.data.Model",config:{idProperty:"id",fields:[{name:"id",type:"int"},{name:"dateCreated",type:"date",dateFormat:"c"},{name:"title",type:"string"},{name:"narrative",type:"string"}],validations:[{type:"presence",field:"id"},{type:"presence",field:"dateCreated"},{type:"presence",field:"title",message:"Please enter a title for this note."}]}});Ext.define("NotesApp.view.NotesList",{extend:"Ext.dataview.List",alias:"widget.noteslist",config:{scrollable:"vertical"},config:{loadingText:"Loading Notes...",itemHeight:65,emptyText:["</pre>",'<div class="notes-list-empty-text">No notes found.</div>',"<pre>"],grouped:true,plugins:[{xclass:"Ext.plugin.PullRefresh"}],itemTpl:["</pre>",'<div class="list-item-title">{title}</div>','<div class="list-item-narrative">{narrative}</div>',"<pre>"]}});Ext.define("NotesApp.view.NotesListContainer",{extend:"Ext.Container",alias:"widget.noteslistcontainer",initialize:function(){this.callParent(arguments);var c={xtype:"button",text:"New",ui:"action",handler:this.onNewButtonTap,scope:this};var b={xtype:"toolbar",title:"My Notes",docked:"top",items:[{xtype:"spacer"},c]};var a={xtype:"noteslist",store:Ext.getStore("Notes"),listeners:{itemtap:{fn:this.onNoteListItemtap,scope:this}}};this.add([b,a])},onNewButtonTap:function(){this.fireEvent("newNoteCommand",this)},onNoteListItemtap:function(d,b,g,a,f,c){this.fireEvent("editNoteCommand",this,a)},onNotesListDisclose:function(e,b,f,d,a,c){this.fireEvent("editNoteCommand",this,b)},config:{layout:{type:"fit"}}});Ext.define("NotesApp.view.NoteEditor",{extend:"Ext.form.Panel",requires:"Ext.form.FieldSet",alias:"widget.noteeditor",config:{scrollable:"vertical"},initialize:function(){this.callParent(arguments);var c={xtype:"button",ui:"back",text:"Home",handler:this.onBackButtonTap,scope:this};var e={xtype:"button",ui:"action",text:"Save",handler:this.onSaveButtonTap,scope:this};var a={xtype:"toolbar",docked:"top",title:"Edit Note",items:[c,{xtype:"spacer"},e]};var g={xtype:"button",iconCls:"trash",iconMask:true,handler:this.onDeleteButtonTap,scope:this};var f={xtype:"toolbar",docked:"bottom",items:[g]};var d={xtype:"textfield",name:"title",label:"Title",required:true};var b={xtype:"textareafield",name:"narrative",label:"Narrative"};this.add([a,{xtype:"fieldset",items:[d,b]},f])},onSaveButtonTap:function(){this.fireEvent("saveNoteCommand",this)},onDeleteButtonTap:function(){this.fireEvent("deleteNoteCommand",this)},onBackButtonTap:function(){this.fireEvent("backToHomeCommand",this)}});Ext.define("NotesApp.controller.Notes",{extend:"Ext.app.Controller",config:{refs:{notesListContainer:"noteslistcontainer",noteEditor:"noteeditor"},control:{notesListContainer:{newNoteCommand:"onNewNoteCommand",editNoteCommand:"onEditNoteCommand"},noteEditor:{saveNoteCommand:"onSaveNoteCommand",deleteNoteCommand:"onDeleteNoteCommand",backToHomeCommand:"onBackToHomeCommand"}}},onNewNoteCommand:function(){var b=new Date();var c=(b.getTime()).toString()+(this.getRandomInt(0,100)).toString();var a=Ext.create("NotesApp.model.Note",{dateCreated:b,title:"",narrative:""});this.activateNoteEditor(a)},onEditNoteCommand:function(b,a){this.activateNoteEditor(a)},onSaveNoteCommand:function(){var c=this.getNoteEditor();var b=c.getRecord();var a=c.getValues();b.set("title",a.title);b.set("narrative",a.narrative);var e=b.validate();if(!e.isValid()){Ext.Msg.alert("Wait!",e.getByField("title")[0].getMessage(),Ext.emptyFn);b.reject();return}var d=Ext.getStore("Notes");if(null==d.findRecord("id",b.data.id)){d.add(b)}d.sync();d.sort([{property:"dateCreated",direction:"DESC"}]);this.activateNotesList()},onDeleteNoteCommand:function(){var b=this.getNoteEditor();var a=b.getRecord();var c=Ext.getStore("Notes");c.remove(a);c.sync();this.activateNotesList()},onBackToHomeCommand:function(){this.activateNotesList()},activateNotesList:function(){Ext.Viewport.animateActiveItem(this.getNotesListContainer(),this.slideRightTransition)},getRandomInt:function(b,a){return Math.floor(Math.random()*(a-b+1))+b},activateNoteEditor:function(a){var b=this.getNoteEditor();b.setRecord(a);Ext.Viewport.animateActiveItem(b,this.slideLeftTransition)},slideLeftTransition:{type:"slide",direction:"left"},slideRightTransition:{type:"slide",direction:"right"},launch:function(){this.callParent(arguments);var a=Ext.getStore("Notes");a.load()},init:function(){this.callParent()}});Ext.define("NotesApp.store.Notes",{extend:"Ext.data.Store",requires:"Ext.data.proxy.Sql",config:{model:"NotesApp.model.Note",proxy:{type:"sql",database:"CountriesDB"},sorters:[{property:"dateCreated",direction:"DESC"}],grouper:{sortProperty:"dateCreated",direction:"DESC",groupFn:function(a){if(a&&a.data.dateCreated){return a.data.dateCreated.toDateString()}else{return""}}}}});Ext.application({name:"NotesApp",controllers:["Notes"],models:["Note"],stores:["Notes"],views:["NotesList","NotesListContainer","NoteEditor"],launch:function(){var b={xtype:"noteslistcontainer"};var a={xtype:"noteeditor"};Ext.Viewport.add([b,a])}});
